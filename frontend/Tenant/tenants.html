<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω ng∆∞·ªùi thu√™</title>
    <link rel="stylesheet" href="tenants.css">
</head>

<body>
    <div class="topbar">
        <h2>üë§ Qu·∫£n l√Ω ng∆∞·ªùi thu√™</h2>
        <button class="logout" onclick="dangXuat()">ƒêƒÉng xu·∫•t</button>
    </div>

    <div class="wrapper">

        <div class="sidebar">
            <h3> MENU</h3>

            <button onclick="chuyenTrang('dashboard.html')"> Dashboard</button>
            <button class="staff" onclick="chuyenTrang('rooms.html')"> Qu·∫£n l√Ω ph√≤ng</button>
            <button class="staff" onclick="chuyenTrang('tenants.html')"> Ng∆∞·ªùi thu√™</button>
            <button class="staff" onclick="chuyenTrang('contracts.html')"> H·ª£p
                ƒë·ªìng</button>
            <button class="staff" onclick="chuyenTrang('bills.html')"> H√≥a ƒë∆°n</button>
            <button class="staff" onclick="chuyenTrang('meters.html')"> ƒêi·ªán n∆∞·ªõc</button>
            <button class="staff" onclick="chuyenTrang('reports.html')">Th·ªëng k√™</button>

            <button class="owner" onclick="chuyenTrang('accounts.html')"> Qu·∫£n l√Ω t√†i
                kho·∫£n</button>
            <button class="owner" onclick="chuyenTrang('settings.html')"> C√†i ƒë·∫∑t h·ªá
                th·ªëng</button>

            <button class="tenant" onclick="chuyenTrang('my-bills.html')"> H√≥a ƒë∆°n c·ªßa
                t√¥i</button>
            <button class="tenant" onclick="chuyenTrang('notifications.html')"> Th√¥ng
                b√°o</button>
        </div>

        <div class="main">


            <div class="card stats">
                <div class="stat">
                    <h2 id="tongNguoiThue">0</h2>
                    <p>T·ªïng ng∆∞·ªùi thu√™</p>
                </div>
                <div class="stat">
                    <h2 id="dangThue">0</h2>
                    <p>ƒêang thu√™</p>
                </div>
                <div class="stat">
                    <h2 id="sapHetHan">0</h2>
                    <p>S·∫Øp h·∫øt h·∫°n</p>
                </div>
                <div class="stat">
                    <h2 id="daTraPhong">0</h2>
                    <p>ƒê√£ tr·∫£ ph√≤ng</p>
                </div>
            </div>

            <div class="card">
                <table>
                    <thead>
                        <tr>
                            <th>T√™n</th>
                            <th>SƒêT</th>
                            <th>Ph√≤ng</th>
                            <th>Ng√†y v√†o</th>
                            <th>H·∫øt h·∫°n</th>
                            <th>Tr·∫°ng th√°i</th>
                        </tr>
                    </thead>
                    <tbody id="danhSachNguoiThue"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const vaiTro = localStorage.getItem("role");
        if (!vaiTro) location.href = "login.html";

        if (vaiTro === "chutro") {
            document.querySelectorAll(".tenant").forEach(e => e.style.display = "none");
        } else if (vaiTro === "nhanvien") {
            document.querySelectorAll(".tenant,.owner[data-page='settings.html']").forEach(e => e.style.display = "none");
        } else if (vaiTro === "nguoithue") {
            document.querySelectorAll(".staff,.owner").forEach(e => e.style.display = "none");
        }
        const tenTrang = location.pathname.split("/").pop();
        document.querySelectorAll(".sidebar button").forEach(btn => {
            if (btn.textContent.includes("Ng∆∞·ªùi thu√™")) btn.classList.add("active");
        });

        let danhSach = [
            { ten: "Nguy·ªÖn Nh∆∞ Th√†nh Danh", sdt: "0123456767", phong: "P101", vao: "2025-01-01", hetHan: "2026-06-01", daTra: false },
            { ten: "ƒê·ªó Duy Ti·∫øn", sdt: "09023434", phong: "P102", vao: "2025-03-01", hetHan: "2026-02-15", daTra: false },
            { ten: "Nguy·ªÖn Quang Huy", sdt: "0903234523", phong: "P103", vao: "2024-01-01", hetHan: "2025-01-01", daTra: true },
        ];

        const tbody = document.getElementById("danhSachNguoiThue");
        const tong = document.getElementById("tongNguoiThue");
        const dangThue = document.getElementById("dangThue");
        const sapHetHan = document.getElementById("sapHetHan");
        const daTra = document.getElementById("daTraPhong");

        function conLai(ngay) {
            return Math.ceil((new Date(ngay) - new Date()) / 86400000);
        }

        function capNhatThongKe() {
            tong.innerText = danhSach.length;
            dangThue.innerText = danhSach.filter(x => !x.daTra && conLai(x.hetHan) > 30).length;
            sapHetHan.innerText = danhSach.filter(x => !x.daTra && conLai(x.hetHan) <= 30).length;
            daTra.innerText = danhSach.filter(x => x.daTra).length;
        }

        function hienThiDanhSach() {
            tbody.innerHTML = "";
            danhSach.forEach(x => {
                let tt = "ƒêang thu√™", mau = "green";
                if (x.daTra) { tt = "ƒê√£ tr·∫£ ph√≤ng"; mau = "red"; }
                else if (conLai(x.hetHan) <= 30) { tt = "S·∫Øp h·∫øt h·∫°n"; mau = "yellow"; }

                tbody.innerHTML += `
                    <tr>
                        <td>${x.ten}</td>
                        <td>${x.sdt}</td>
                        <td>${x.phong}</td>
                        <td>${x.vao}</td>
                        <td>${x.hetHan}</td>
                        <td><span class="badge ${mau}">${tt}</span></td>
                    </tr>`;
            });
            capNhatThongKe();
        }

        hienThiDanhSach();

        function chuyenTrang(p) {
            if (p === 'dashboard.html') location.href = '../Dashboard/dashboard.html';
            else if (p === 'tenants.html') location.href = '../Tenant/tenants.html';
            else if (p === 'bills.html') location.href = '../Bill/bills.html';
            else location.href = p;
        }

        function dangXuat() {
            localStorage.clear();
            location.href = "../Login/login.html";
        }
    </script>


</body>

</html>